import{r as p}from"./index.D6whbu08.js";import{j as m}from"./jsx-runtime.D_zvdyIk.js";import{c as I}from"./utils.BpMRZbEX.js";function H(e){let n="";const t=new Set;let r=null;const s=new Map,a=()=>{t.forEach(o=>{o()})},u=()=>{if(s.size===0)return;let o="",c=Number.POSITIVE_INFINITY;s.forEach((h,d)=>{h<c&&(c=h,o=d)}),n!==o&&(n=o,a())},i=()=>{r&&r.disconnect(),s.clear();const o=`-${e}px 0px -70% 0px`;r=new IntersectionObserver(h=>{for(const d of h){const f=d.target.id;f&&(d.isIntersecting?s.set(f,d.boundingClientRect.top):s.delete(f))}u()},{rootMargin:o,threshold:0});const c=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");c.forEach(h=>{r?.observe(h)}),c.length>0&&s.size===0&&requestAnimationFrame(()=>{const h=Array.from(c);for(let d=h.length-1;d>=0;d--){const f=h[d];if(f.getBoundingClientRect().top<e&&f.id){n!==f.id&&(n=f.id,a());break}}})},l=()=>{n="",s.clear(),requestAnimationFrame(()=>{i()})};return{subscribe:o=>(t.size===0&&(i(),document.addEventListener("astro:page-load",l)),t.add(o),()=>{t.delete(o),t.size===0&&(r&&(r.disconnect(),r=null),document.removeEventListener("astro:page-load",l),s.clear())}),getSnapshot:()=>n,getServerSnapshot:()=>""}}function O({offsetTop:e=120}={}){const n=p.useMemo(()=>H(e),[e]);return p.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getServerSnapshot)}function L(e){const n=[],t=[];return e.forEach(r=>{const s={...r,children:[]};for(;t.length>0&&t[t.length-1].level>=s.level;)t.pop();if(t.length===0)n.push(s);else{const a=t[t.length-1];a.children.push(s),s.parent=a}t.push(s)}),n}function R(){const[e,n]=p.useState([]),[t,r]=p.useState(0);return p.useEffect(()=>{const s=()=>r(a=>a+1);return document.addEventListener("astro:page-load",s),()=>document.removeEventListener("astro:page-load",s)},[]),p.useEffect(()=>{const s=document.querySelector("article");if(!s){n([]);return}const a=s.querySelectorAll("h1:not(.link-preview-block h1), h2:not(.link-preview-block h2), h3:not(.link-preview-block h3), h4:not(.link-preview-block h4), h5:not(.link-preview-block h5), h6:not(.link-preview-block h6)");if(a.length===0)return;const u=Array.from(a).map((l,o)=>{let c=l.id;return c||(c=(l.textContent||"").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim()||`heading-${o}`,l.id=c),{id:c,text:l.textContent||"",level:parseInt(l.tagName.substring(1),10)}}),i=L(u);n(i)},[]),e}function v(e,n){for(const t of e){if(t.id===n)return t;const r=v(t.children,n);if(r)return r}return null}function y(e){const n=[];let t=e.parent;for(;t;)n.push(t.id),t=t.parent;return n}function k(e,n){const t=[];return e.parent?e.parent.children.forEach(r=>{r.id!==e.id&&r.children.length>0&&t.push(r.id)}):n.forEach(r=>{r.id!==e.id&&r.children.length>0&&t.push(r.id)}),t}function _({headings:e,activeId:n,defaultExpanded:t=!1}){const[r,s]=p.useState(()=>{if(t){let i=function(o){o.forEach(c=>{c.children.length>0&&l.add(c.id),i(c.children)})};const l=new Set;return i(e),l}return new Set});p.useEffect(()=>{if(n&&e.length>0){const i=v(e,n);if(i){const o=[...y(i)];i.children.length>0&&o.unshift(n),o.length>0&&s(c=>{const h=new Set(c),d={};return o.forEach(f=>{const g=v(e,f);g&&(d[g.level]||(d[g.level]=[]),d[g.level].push(f))}),Object.keys(d).forEach(f=>{const g=parseInt(f,10);d[g].forEach(E=>{const x=v(e,E);x&&(k(x,e).forEach(w=>{h.delete(w)}),h.add(E))})}),h})}}},[n,e]);const a=p.useCallback(i=>r.has(i),[r]),u=p.useCallback(i=>{s(l=>{const o=new Set(l);return o.has(i)?o.delete(i):o.add(i),o})},[]);return{expandedIds:r,isExpanded:a,toggleExpanded:u,setExpandedIds:s}}function z({headings:e,setExpandedIds:n}){return p.useCallback(t=>{const r=document.getElementById(t);if(!r)return;r.scrollIntoView({behavior:"smooth",block:"start"});const s=v(e,t);if(!s)return;const a=y(s);s.children.length>0&&a.unshift(t),a.length!==0&&n(u=>{const i=new Set(u),l={};return a.forEach(o=>{const c=v(e,o);c&&(l[c.level]||(l[c.level]=[]),l[c.level].push(o))}),Object.keys(l).forEach(o=>{const c=parseInt(o,10);l[c].forEach(d=>{const f=v(e,d);f&&(k(f,e).forEach(b=>{i.delete(b)}),i.add(d))})}),i})},[e,n])}const A=.75,C=1,N=({heading:e,depth:n=0,isActive:t=!1,isExpanded:r=!1,onHeadingClick:s,renderChildren:a})=>{const u=e.children.length>0;return m.jsxs("div",{className:"heading-tree-item relative",children:[m.jsxs("a",{href:`#${e.id}`,onClick:i=>{i.preventDefault(),s(e.id)},className:I("heading-link group relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2 hover:bg-foreground/5",{"border-l-primary bg-primary/10 font-medium text-primary hover:bg-primary/10 hover:text-primary":t}),style:{paddingLeft:`${A+n*C}rem`,paddingRight:u?"0.5rem":"0.75rem"},"data-level":e.level,"aria-label":e.text,"aria-current":t?"location":void 0,children:[m.jsx("span",{className:"heading-text block flex-1 truncate leading-relaxed",children:e.text}),t&&m.jsx("span",{className:"ml-2 text-primary text-xs",children:"â€¢"})]}),u&&r&&a&&m.jsx("div",{className:"heading-children",children:a(e.children,n+1)})]},e.id)},S=p.memo(N),j=({headings:e,depth:n=0,activeId:t,expandedIds:r,onHeadingClick:s})=>{const a=p.useCallback((u,i)=>u.map(l=>m.jsx(S,{heading:l,depth:i,isActive:t===l.id,isExpanded:r.has(l.id),onHeadingClick:s,renderChildren:a},l.id)),[t,r,s]);return m.jsx(m.Fragment,{children:e.map(u=>m.jsx(S,{heading:u,depth:n,isActive:t===u.id,isExpanded:r.has(u.id),onHeadingClick:s,renderChildren:a},u.id))})},F=p.memo(j);export{F as H,O as a,_ as b,z as c,R as u};
