import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{b as k,u as j,D as w,a as y}from"./useKeyboardShortcut.DCroO9rU.js";import{u as C}from"./useIsMounted.BG1lVfvv.js";import{c as L}from"./utils.BpMRZbEX.js";import{u as E}from"./index.CTdVSFIz.js";import{c as u,j as N,o as b}from"./modal.BeECZm2d.js";import{r as a}from"./index.D6whbu08.js";import{A as S}from"./index.s74VRsaB.js";import{m as f}from"./proxy.C2vk4wBE.js";function g({className:n}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:n,children:[e.jsx("title",{children:"Search"}),e.jsx("path",{d:"M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"})]})}function M({className:n}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:n,children:[e.jsx("title",{children:"Close"}),e.jsx("path",{d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z"})]})}function P(){const n=E(N),[r,l]=a.useState(-1),m=a.useRef(null),i=a.useRef(null);k({key:"k",modifiers:["meta"],handler:()=>b("search")}),j(()=>{n&&u()},n);const o=a.useCallback(()=>{const t=Array.from(document.querySelectorAll(".pagefind-ui__result")),s=document.querySelector(".pagefind-ui__button");return s&&s.offsetParent!==null?[...t,s]:t},[]),p=a.useCallback(()=>{const t=o();r>=0&&r<t.length&&t[r]?.removeAttribute("data-selected"),l(-1)},[r,o]),h=a.useCallback(t=>{const s=o();if(s.length===0){l(-1);return}const c=Math.max(-1,Math.min(t,s.length-1));r>=0&&r<s.length&&s[r]?.removeAttribute("data-selected"),l(c),c>=0?(s[c].setAttribute("data-selected","true"),s[c].scrollIntoView({block:"nearest",behavior:"smooth"})):document.querySelector(".pagefind-ui__search-input")?.focus()},[r,o]),x=a.useCallback(()=>{const t=o();if(r<0||r>=t.length)return;const s=t[r];if(s.classList.contains("pagefind-ui__button")){s.click(),l(-1);return}const c=s.querySelector(".pagefind-ui__result-link");c?.href&&(u(),window.location.href=c.href)},[r,o]);a.useEffect(()=>{if(!n)return;const t=s=>{s.key==="ArrowDown"?(s.preventDefault(),h(r+1)):s.key==="ArrowUp"?(s.preventDefault(),h(r-1)):s.key==="Enter"&&r>=0&&(s.preventDefault(),x())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[n,r,h,x]),a.useEffect(()=>{if(!n){i.current?.disconnect(),i.current=null;return}const t=document.getElementById("search-dialog-container");if(t)return i.current=new MutationObserver(()=>{p()}),i.current.observe(t,{childList:!0,subtree:!0}),()=>{i.current?.disconnect(),i.current=null}},[n,p]),a.useEffect(()=>{n?(window.dispatchEvent(new CustomEvent("search-dialog-open")),setTimeout(()=>{document.querySelector(".pagefind-ui__search-input")?.focus()},150)):window.dispatchEvent(new CustomEvent("search-dialog-close"))},[n]),a.useEffect(()=>{const t=()=>{n&&u()};return document.addEventListener("astro:before-preparation",t),()=>{document.removeEventListener("astro:before-preparation",t)}},[n]);const d=a.useCallback(()=>{u()},[]),v=a.useCallback(t=>{t.target===t.currentTarget&&d()},[d]);return e.jsx(w,{open:n,onOpenChange:t=>!t&&d(),children:e.jsx(y,{forceMount:!0,children:e.jsx(S,{children:n&&e.jsxs(e.Fragment,{children:[e.jsx(f.div,{className:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}}),e.jsx(f.div,{className:"fixed inset-0 z-50 grid place-items-center px-4",onClick:v,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(f.div,{className:"w-full max-w-3xl overflow-auto rounded-xl bg-gradient-start shadow-box",initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:{duration:.2},children:e.jsxs("div",{className:"relative p-6 md:p-3",children:[e.jsxs("div",{className:"search-dialog",children:[e.jsxs("div",{className:"relative mb-4 flex items-center justify-between",children:[e.jsxs("h2",{className:"flex items-center gap-2 font-semibold text-lg md:text-base",children:[e.jsx(g,{className:"size-5 md:size-4"}),"搜索文章"]}),e.jsx("button",{type:"button",onClick:d,className:"flex size-8 items-center justify-center rounded-full bg-black/5 transition-colors duration-300 hover:bg-black/10 md:size-7 dark:bg-white/10 dark:hover:bg-white/20","aria-label":"关闭搜索",children:e.jsx(M,{className:"size-5 md:size-4"})})]}),e.jsxs("div",{id:"search-empty-hint",className:"search-empty-hint absolute inset-x-0 top-32 text-center text-sm opacity-60 md:top-28",children:[e.jsx("p",{children:"输入关键词搜索博客文章"}),e.jsxs("p",{className:"mt-1 text-xs",children:["按 ",e.jsx("kbd",{className:"rounded bg-black/10 px-1.5 py-0.5 font-mono dark:bg-white/10",children:"ESC"})," 关闭"]})]}),e.jsx("div",{className:"vertical-scrollbar scroll-feather-mask -mx-6 h-[calc(80dvh-140px)] overflow-auto scroll-smooth px-6 pb-8 after:bottom-10 md:-mx-3 md:h-[calc(80dvh-120px)] md:px-3",children:e.jsx("div",{id:"search-dialog-container",ref:m})})]}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 z-10 flex items-center justify-center gap-4 bg-gradient-start px-4 pt-1 pb-4 text-black/50 text-xs dark:border-white/10 dark:text-white/50",children:[e.jsxs("span",{children:[e.jsx("kbd",{className:"kbd",children:"↑↓"})," 选择"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"kbd",children:"Enter"})," 打开"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"kbd",children:"ESC"})," 关闭"]})]})]})})})]})})})})}function T({className:n}){const r=C(),l=a.useMemo(()=>{if(!r)return;const i=navigator.userAgentData?.platform||navigator.userAgent;return`搜索 (${/mac/i.test(i)?"⌘K":"Ctrl+K"})`},[r]),m=()=>{b("search")};return e.jsx("button",{type:"button",onClick:m,className:L("cursor-pointer transition duration-300 hover:scale-125",n),"aria-label":"搜索",title:l,children:e.jsx(g,{className:"size-8"})})}export{T as S,P as a};
